<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/TokenDrop.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> TokenDrop.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/41</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/41</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity &gt;=0.7.0 &lt;0.8.0;
&nbsp;
// Testing
import "hardhat/console.sol";
&nbsp;
// External Interfaces
import "@openzeppelin/contracts-upgradeable/proxy/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/token/ERC20/IERC20Upgradeable.sol";
&nbsp;
// External Libraries
import "@openzeppelin/contracts/math/SafeMath.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@pooltogether/fixed-point/contracts/FixedPoint.sol";
&nbsp;
// Local Interfaces
import "./interfaces/TokenListenerInterface.sol";
&nbsp;
// Local Libraries
import "./libraries/ExtendedSafeCast.sol";
&nbsp;
/**
 * @title TokenDrop
 * @author Kames Cox-Geraghty
 * @notice Manage POOL Token Dripping
 * @dev Calculate an account rewards based of active deposits
 */
contract TokenDrop is Initializable {
    /***********************************|
    |   Libraries                       |
    |__________________________________*/
    using SafeMath for uint256;
    using ExtendedSafeCast for uint256;
&nbsp;
    /***********************************|
    |   Libraries                       |
    |__________________________________*/
    /// @notice The token that is being disbursed
    IERC20Upgradeable public asset;
&nbsp;
    /// @notice The token that is user to measure a user's portion of disbursed tokens
    IERC20Upgradeable public measure;
&nbsp;
    /// @notice The cumulative exchange rate of measure token supply : dripped tokens
    uint112 public exchangeRateMantissa;
&nbsp;
    /// @notice The total amount of tokens that have been dripped but not claimed
    uint112 public totalUnclaimed;
&nbsp;
    /// @notice The timestamp at which the tokens were last dripped
    uint32 public lastDripTimestamp;
&nbsp;
    // Factory
    address public factory;
&nbsp;
    /***********************************|
    |   Events                          |
    |__________________________________*/
    event Dripped(uint256 newTokens);
&nbsp;
    event Deposited(address indexed user, uint256 amount);
&nbsp;
    event Claimed(address indexed user, uint256 newTokens);
&nbsp;
    /***********************************|
    |   Structs                         |
    |__________________________________*/
    struct UserState {
        uint128 lastExchangeRateMantissa;
        uint256 balance;
    }
&nbsp;
    /**
     * @notice The data structure that tracks when a user last received tokens
     */
    mapping(address =&gt; UserState) public userStates;
&nbsp;
    /***********************************|
    |   Initialize                      |
    |__________________________________*/
    /**
     * @notice Initialize TokenDrop Smart Contract
     */
<span class="fstat-no" title="function not covered" >    function initialize(address _measure, address _asset) external {</span>
<span class="cstat-no" title="statement not covered" >        measure = IERC20Upgradeable(_measure)</span>;
<span class="cstat-no" title="statement not covered" >        asset = IERC20Upgradeable(_asset)</span>;
&nbsp;
        // Set Factory Deployer
<span class="cstat-no" title="statement not covered" >        factory = msg.sender</span>;
    }
&nbsp;
    /**
     * @notice Add Pod reference to TokenDrop Smart Contract
     */
<span class="fstat-no" title="function not covered" >    function initializePod(address _measure) external {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == factory, "Pod: Unauthorized PodDrop Factory")</span>;
<span class="cstat-no" title="statement not covered" >        measure = IERC20Upgradeable(_measure)</span>;
    }
&nbsp;
    /***********************************|
    |   Public/External                 |
    |__________________________________*/
&nbsp;
<span class="fstat-no" title="function not covered" >    function _currentTime() internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return block.timestamp;</span>
    }
&nbsp;
    /**
     * @notice Should be called before "measure" tokens are transferred or burned
     * @param from The user who is sending the tokens
     * @param to The user who is receiving the tokens
     *@param token The token token they are burning
     */
<span class="fstat-no" title="function not covered" >    function beforeTokenTransfer(</span>
        address from,
        address to,
        address token
    ) external {
        // must be measure and not be minting
<span class="cstat-no" title="statement not covered" >        if (token == address(measure)) {</span>
<span class="cstat-no" title="statement not covered" >            drop()</span>;
&nbsp;
            // Calcuate to tokens balance
<span class="cstat-no" title="statement not covered" >            _captureNewTokensForUser(to)</span>;
&nbsp;
            // If NOT minting calcuate from tokens balance
<span class="cstat-no" title="statement not covered" >            if (from != address(0)) {</span>
<span class="cstat-no" title="statement not covered" >                _captureNewTokensForUser(from)</span>;
            }
        }
    }
&nbsp;
    /**
     * @notice Add Asset to TokenDrop and update with drop()
     * @dev Add Asset to TokenDrop and update with drop()
     * @param amount User account
     */
<span class="fstat-no" title="function not covered" >    function addAssetToken(uint256 amount) external returns (bool) {</span>
        // Transfer asset/reward token from msg.sender to TokenDrop
<span class="cstat-no" title="statement not covered" >        asset.transferFrom(msg.sender, address(this), amount)</span>;
&nbsp;
        // Update TokenDrop asset balance
<span class="cstat-no" title="statement not covered" >        drop()</span>;
&nbsp;
        // Return BOOL for transaction gas savings
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
&nbsp;
    /**
     * @notice Claim asset rewards
     * @dev Claim asset rewards
     * @param user User account
     */
<span class="fstat-no" title="function not covered" >    function claim(address user) external returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        drop()</span>;
<span class="cstat-no" title="statement not covered" >        _captureNewTokensForUser(user)</span>;
<span class="cstat-no" title="statement not covered" >        uint256 balance = userStates[user].balance;</span>
<span class="cstat-no" title="statement not covered" >        userStates[user].balance = 0</span>;
<span class="cstat-no" title="statement not covered" >        totalUnclaimed = uint256(totalUnclaimed).sub(balance).toUint112()</span>;
&nbsp;
        // Transfer asset/reward token to user
<span class="cstat-no" title="statement not covered" >        asset.transfer(user, balance)</span>;
&nbsp;
        // Emit Claimed
<span class="cstat-no" title="statement not covered" >        emit Claimed(user, balance);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return balance;</span>
    }
&nbsp;
    /**
     * @notice Drips new tokens.
     * @dev Should be called immediately before any measure token mints/transfers/burns
     * @return The number of new tokens dripped.
     */
&nbsp;
    // change to drop
<span class="fstat-no" title="function not covered" >    function drop() public returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 assetTotalSupply = asset.balanceOf(address(this));</span>
<span class="cstat-no" title="statement not covered" >        uint256 newTokens = assetTotalSupply.sub(totalUnclaimed);</span>
&nbsp;
        // if(newTokens &gt; 0)
<span class="cstat-no" title="statement not covered" >        if (newTokens &gt; 0) {</span>
            // Check measure token totalSupply()
<span class="cstat-no" title="statement not covered" >            uint256 measureTotalSupply = measure.totalSupply();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            uint256 indexDeltaMantissa =</span>
                FixedPoint.calculateMantissa(newTokens, measureTotalSupply);
<span class="cstat-no" title="statement not covered" >            uint256 nextExchangeRateMantissa =</span>
                uint256(exchangeRateMantissa).add(indexDeltaMantissa);
&nbsp;
<span class="cstat-no" title="statement not covered" >            exchangeRateMantissa = nextExchangeRateMantissa.toUint112()</span>;
<span class="cstat-no" title="statement not covered" >            totalUnclaimed = uint256(totalUnclaimed).add(newTokens).toUint112()</span>;
&nbsp;
            // Emit Dripped
<span class="cstat-no" title="statement not covered" >            emit Dripped(newTokens);</span>
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return newTokens;</span>
    }
&nbsp;
    /***********************************|
    |   Private/Internal                |
    |__________________________________*/
&nbsp;
    /**
     * @notice Captures new tokens for a user
     * @dev This must be called before changes to the user's balance (i.e. before mint, transfer or burns)
     * @param user The user to capture tokens for
     * @return The number of new tokens
     */
<span class="fstat-no" title="function not covered" >    function _captureNewTokensForUser(address user) private returns (uint128) {</span>
<span class="cstat-no" title="statement not covered" >        UserState storage userState = userStates[user];</span>
<span class="cstat-no" title="statement not covered" >        if (exchangeRateMantissa == userState.lastExchangeRateMantissa) {</span>
            // ignore if exchange rate is same
<span class="cstat-no" title="statement not covered" >            return 0;</span>
        }
<span class="cstat-no" title="statement not covered" >        uint256 deltaExchangeRateMantissa =</span>
            uint256(exchangeRateMantissa).sub(
                userState.lastExchangeRateMantissa
            );
<span class="cstat-no" title="statement not covered" >        uint256 userMeasureBalance = measure.balanceOf(user);</span>
<span class="cstat-no" title="statement not covered" >        uint128 newTokens =</span>
            FixedPoint
                .multiplyUintByMantissa(
                userMeasureBalance,
                deltaExchangeRateMantissa
            )
                .toUint128();
&nbsp;
<span class="cstat-no" title="statement not covered" >        userStates[user] = UserState({</span>
            lastExchangeRateMantissa: exchangeRateMantissa,
            balance: uint256(userState.balance).add(newTokens).toUint128()
        });
&nbsp;
<span class="cstat-no" title="statement not covered" >        return newTokens;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function supportsInterface(bytes4 interfaceId)</span>
        external
        view
        returns (bool)
    {
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Mar 24 2021 17:16:59 GMT-0700 (Pacific Daylight Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
